# 🐑 BotShepherd 快速指南

欢迎使用 BotShepherd！本指南将帮助您快速了解配置面板和指令系统。

## 📋 配置面板主要配置项

### 全局配置 (系统设置页面)

#### 基础设置
- **超级用户列表** (`superusers`)
  - 含义：拥有最高权限的用户ID列表
  - 举例：`["123456789", "987654321"]`
  - 说明：超级用户可以执行所有指令，消息不受过滤限制

- **指令前缀** (`command_prefix`)
  - 含义：触发指令的前缀字符
  - 举例：`"bs"` (指令格式为 `bs帮助`)
  - 说明：可自定义前缀，避免与其他框架冲突

- **触发前缀❗** (`trigger_prefix`)
  - 含义：消息模拟指令的前缀
  - 举例：`"bs触发"` (格式为 `bs触发 对方ID 指令`)
  - 说明：用于模拟其他用户发送指令，帮助其他用户执行指令。该配置只能在配置文件中修改。**Bot自身也可以触发。**但无需担心被诱导触发指令，因为禁止将别名设置为触发前缀的首个字符相同，无法通过别名设置绕开。

#### 权限控制
- **允许私聊** (`allow_private`)
  - 含义：是否允许在私聊中使用指令
  - 举例：`true` 或 `false`
  - 说明：关闭后所有私聊指令将被忽略

- **仅好友私聊** (`private_friend_only`)
  - 含义：私聊指令是否仅限好友使用
  - 举例：`true` (仅好友可用) 或 `false` (所有人可用)
  - 说明：增强安全性，防止陌生人滥用

#### 过滤系统
- **全局过滤词** (`global_filters`)
  - **接收过滤** (`receive_filters`)：阻止包含特定词汇的消息传递给框架。群管设置的群过滤可以用于**过滤不想要的功能**，比如今日运势，则机器人不再收到今日运势请求。仅限群过滤，还会匹配发送者与机器人。可以把ID作为群过滤词来在群里**忽略某个人**或**禁用某个机器人**。为了进一步实现某群某机禁用某功能，所有过滤词支持 and 或 or 模式，分别使用 `+` 和 `|` 连接。例如：某群的bot12345 不想要收到abc，可以设置过滤词为 `abc+12345`。不支持一个字符串中同时具有两种模式。
    - 举例：`["广告", "刷单", "涩图"]`
  - **发送过滤** (`send_filters`)：阻止包含特定词汇的消息发送给客户端，主要针对ai回复等**不可控内容**。同样可以使用 and 或 or 模式。
    - 举例：`["敏感词", "违禁内容"]`
  - **前缀保护** (`prefix_protections`)：为特定前缀添加警告标识，主要用于人机合一时，可以允许人机执行高级指令，但防止被人利用复读功能或ai不受控的执行。
    - 举例：`["/拉黑", "/设置主人"]` (防止用户被诱导使用其他Bot指令)

- **黑名单** (`blacklist`)
  - **用户黑名单** (`users`)：被禁用的用户ID列表
    - 举例：`["111111111", "222222222"]`
  - **群组黑名单** (`groups`)：被禁用的群组号列表
    - 举例：`["333333333", "444444444"]`

#### 数据库设置
- **数据路径** (`data_path`)
  - 含义：数据库文件存储位置
  - 举例：`"./data"` (相对路径) 或 `"/var/botshepherd/data"` (绝对路径)
  - 说明：建议使用相对路径，便于迁移

- **自动过期天数** (`auto_expire_days`)
  - 含义：消息数据自动清理的天数
  - 举例：`30` (30天后自动删除旧数据)
  - 说明：设置为 `-1` 表示永不过期

#### Web界面设置
- **Web认证** (`web_auth`)
  - **用户名** (`username`)：Web界面登录用户名
    - 举例：`"admin"` (默认值，建议修改)
  - **密码** (`password`)：Web界面登录密码
    - 举例：`"your_secure_password"` (请修改默认密码)
  - 说明：密码是明文存储，请避免其他人访问配置文件目录。

- **Web端口** (`web_port`)
  - 含义：Web管理界面的访问端口
  - 举例：`5100` (访问地址为 http://localhost:5100)
  - 说明：确保端口未被其他程序占用

#### 消息标准化
- **启用标准化** (`message_normalization`)
  - 含义：是否启用消息格式标准化
  - 举例：`true` (推荐开启)
  - 说明：启用消息转换

- **标准化NapCat发送** (`normalize_napcat_sent`)
  - 含义：是否标准化NapCat发送的消息格式
  - 举例：`true`
  - 说明：解决NapCat自身上报与Nonebot的兼容性问题，需要先打开启用标准化

### 连接配置 (连接管理页面)

- **连接ID** (`connection_id`)
  - 含义：连接的唯一标识符
  - 举例：`"conn_001"`
  - 说明：连接ID不能重复，且不能包含特殊字符

- **连接名称** (`name`)
  - 含义：连接的显示名称

- **连接描述** (`description`)
  - 含义：连接的详细说明
  - 举例：`"连接到NapCat和Yunzai-Bot"`

- **客户端端点** (`client_endpoint`)
  - 含义：客户端连接的WebSocket地址
  - 举例：`"ws://localhost:1212"`，如果nc不在本机上，localhost换成0.0.0.0，而nc填写bs所在的IP或域名即可。端口需要是本机空闲可用的。bs没有验证入端token，因为只要保护好你的nc和正确的配置主人，即使别人连上bs也不会造成严重事故，且bs支持查看连接的账号。
  - 说明：这是客户端(如QQ)连接到BotShepherd的地址，只需要保证一致即可，确保发来的结构是onebotv11。Napcat的话就是网络配置里输什么就是什么，路径之类的不影响。

- **目标端点列表** (`target_endpoints`)
  - 含义：BotShepherd转发消息的目标框架地址列表
  - 举例：`["ws://localhost:3001/OneBot/v11/ws", "ws://localhost:3002/ws"]`，如果框架不在本机上，localhost换成对应IP或域名即可。
  - 说明：支持一对多转发。注意原先客户端填写的目标是什么，这里就写什么，需要包含路径。如果需要使用token，路径后面加上 `?token=你的token` 即可，这是ws连接传递参数的通用方式。

- **启用状态** (`enabled`)
  - 含义：是否启用此连接
  - 举例：`true` (启用) 或 `false` (禁用)
  - 说明：禁用连接将**自动重启**

### 群组配置 (群组管理页面)

- **群组ID** (`group_id`)：群组的唯一标识符
- **群组描述** (`description`)：群组的自定义描述
- **启用状态** (`enabled`)：是否在此群组中启用BotShepherd
- **到期时间** (`expire_time`)：群组配置的过期时间
- **过滤设置** (`filters`)：主人级别和群管理员级别的过滤词配置

### 别名配置

所有别名的逻辑就是：将alias列表中的前缀替换为key。如果key本身不在alias中，会被替换为空，实现旁路原指令。如果想保留原指令，把原指令也作为alias即可。

- **全局别名** (`global_aliases`)：所有群组和账号通用的指令别名。比如群里有别人的yunzai bot，可以把基础的/转为别的别名。
- **账号别名** (`account_aliases`)：特定账号的指令别名。比如如果机器人名字不同，想要公用一个ai聊天框架，可以每个账号单独设置自己的名字，指向ai聊天前缀。
- **群组别名** (`group_aliases`)：特定群组的指令别名，看群里人喜好咯。

## 🤖 主要指令系统

> **重要说明**：所有指令的功能都可以通过Web配置面板实现，指令只是提供了快捷的操作方式。

### 帮助指令
- `bs帮助` - 显示所有可用指令列表
- `bs帮助 指令名` - 显示特定指令的详细使用方法

### 统计查询指令
- `bs统计` - 显示今日消息统计概览

*配置面板对应*：统计分析页面 - 可视化图表和数据查询

### 黑名单管理指令
- `bs黑名单` - 黑名单配置

*配置面板对应*：系统设置页面 - 黑名单配置区域


### 过滤管理指令
- `bs过滤` - 过滤规则
- `bs全局过滤` - 全局过滤规则

*配置面板对应*：过滤设置页面 - 全局和群组过滤配置

### 系统管理指令
- `bs状态` - 查看系统运行状态
- `bs连接` - 查看WebSocket连接状态
- `bs重载` - 重新加载配置文件 (需要超级用户权限)
- `bs更新` - 检查GitHub更新并自动执行更新 (需要超级用户权限)
- `bs备份` - 立即创建加密配置备份并发送文件，仅限群聊使用 (需要超级用户权限)

*配置面板对应*：仪表板页面 - 系统状态监控；备份管理页面 - 备份文件下载

### 消息模拟指令
- `bs触发 对方ID 指令` - 模拟指定用户发送指令。主人与Bot具有该权限，可以自己手机上Bot号发送触发指令。默认设置下无需担心诱导触发指令，因为禁止将别名设置为触发前缀的首个字符相同，无法通过别名设置绕开。

---

💡 **提示**：虽然指令提供了快捷操作方式，但推荐使用Web配置面板进行系统管理，界面更直观，操作更安全。